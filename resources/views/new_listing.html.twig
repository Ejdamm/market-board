{% extends 'templates/base.html.twig' %}

{% block content %}
  <form method="post">
    <div class="form-group">
      <label for="new_listing_email">{{ language.email_address }}</label>
      <input type="email" class="form-control" id="new_listing_email" value="{{ params.email }}" placeholder="{{ language.enter_your_email }}" name="email" required>
    </div>
    <div class="form-group">
      <label for="new_listing_category">{{ language.category }}</label>
      <select class="form-control" id="new_listing_category" name="category_id" required>
        <option value="">{{ language.choose_category }}</option>
        {% for category in categories %}
          <option value="{{ category.id }}" class="{{ category.category_name }}" {% if category.id == params.category_id %}selected{% endif %}>{{ category.category_name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form-group">
      <label for="new_listing_subcategory">{{ language.subcategory }}</label>
      <select class="form-control" id="new_listing_subcategory" name="subcategory_id" required>
        <option value="">{{ language.choose_subcategory }}</option>
        {% for subcategory in subcategories %}
          <option value="{{ subcategory.id }}" class="{{ subcategory.category_name }}" {% if subcategory.id == params.subcategory_id %}selected{% endif %}>{{ subcategory.subcategory_name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form-group">
      <label for="new_listing_price">{{ language.unit_price }}</label>
      <input type="number" class="form-control" id="new_listing_price" value="{{ params.unit_price }}" placeholder="{{ language.enter_unit_price }}" name="unit_price" required>
    </div>
    <div class="form-group">
      <label for="new_listing_amount">{{ language.quantity }}</label>
      <input type="number" class="form-control" id="new_listing_amount" placeholder="{{ language.enter_quantity }}" name="quantity" value={% if params is defined %}{{ params.quantity }}{% else %}1{% endif %} min="1" required>
    </div>
    <div class="form-group">
      <label for="new_listing_description">{{ language.description }}</label>
      <textarea class="form-control" id="new_listing_description" name="description" rows="4">{{ params.description }}</textarea>
    </div>

    <img class="my-2" alt="captcha_image" src="{{ captcha }}" />
    <div class="form-group">
      <label for="new_listing_captcha">{{ language.captcha }}</label>
      <input type="text" class="form-control" id="new_listing_captcha" placeholder="{{ language.enter_captcha }}" name="captcha" required>
    </div>

    <button type="submit" class="btn btn-primary">{{ language.create_listing }}</button>
  </form>

  <!-- query to filter second dropdown -->
  <!-- https://stackoverflow.com/a/20478291/5318606-->
  <script >
  $(document).ready(function () {
    var subCatOptions = $('#new_listing_sub_category option');

    // Subcategory filtering depending on category
    $('#new_listing_category').change(function () {
      filterSubCategoryOptions(subCatOptions);
      $('#new_listing_sub_category option[value=""]').prop('selected', true);
    });

    // Subcategory filtering depending on subcategory
    $('#new_listing_sub_category').change(function () {
      var selectedSubCategory = $('#new_listing_sub_category option:selected');
      var subCatClass = selectedSubCategory.prop('class');

      // Make sure the category corresponds to chosen subcategory
      if ($('#new_listing_category option:selected').prop('class') != subCatClass) {
        $('#new_listing_category .' + subCatClass).prop('selected', true);
      }
      filterSubCategoryOptions(subCatOptions);
      // Reselect the selected option because it was lost in the filtering
      selectedSubCategory.prop('selected', true);
    });
  });

  function filterSubCategoryOptions(options){
    var categoryClass = $('#new_listing_category option:selected').prop('class');

    // Always reset subcategory options
    $('#new_listing_sub_category option').remove();
    $('#new_listing_sub_category').append(options);

    if (categoryClass != "") {
      $('#new_listing_sub_category :not(.' + categoryClass + ',option[value=""])').remove();
    }
  }
  </script>

{% endblock %}

